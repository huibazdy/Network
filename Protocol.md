## IP

### 子网掩码

* ***功能***：子网掩码是用来指明IP地址哪部分是子网号，哪部分是主机号的方法
* ***组成***：子网掩码是32个bit位的二进制数，0的部分代表主机号，1的部分是网络号加子网号。

利用子网掩码，我们可以对一个IPv4的IP地址按以下流程进行解析：

<img src="https://raw.githubusercontent.com/huibazdy/TyporaPicture/main/202209271629327.png" alt="image-20220927162937245" style="zoom: 50%;" />



## ARP

> ARP的作用是将IP地址转为在链路层使用的`48bit`以太网地址。

IP地址与链路层地址之间的互相转换通过`ARP`与`RARP`来实现。



## TCP

### 概述

TCP与UDP都为应用层提供全双工传输服务且使用相同网络层，但是原理不同：

* ***面向连接***

    面向连接指通信两端（使用TCP的应用程序，也称为客户端与服务器）必须先建立连接才能通信，例如想要和地球另一边的人说话，先拨打电话（就是建立的连接）才能进行通话。

* ***可靠性***

    TCP通过下列方式来提供可靠性：

    1. 分割：应用层数据分割成TCP认为最合适发送的数据块
    2. 超时：设置定时器保证接收到（超时重传）
    3. 确认：发送确认信息（推迟固定时间发送）
    4. 校验：校验和，首部和数据
    5. 失序：重排
    6. 重复：丢弃
    7. 限速：流量控制，防止两端缓冲区溢出

* ***字节流***

    通过TCP交换的数据是8bit字节构成的字节流。



### 格式

TCP数据（应用数据）被封装在一个IP数据报中，如下图：

![image-20220928175452983](https://raw.githubusercontent.com/huibazdy/TyporaPicture/main/202209281754013.png)

TCP首部一般是20字节，首部结构如下图：

![image-20220928194714912](https://raw.githubusercontent.com/huibazdy/TyporaPicture/main/202209281947957.png)

* ***端口号***：用于找到收发两端的应用进程（IP地址加上端口号就是一个socket）

* ***序号***：序号（seq）是32位无符号数，用来标识TCP字节流，表示该报文段中第一个数据字节，序号达到 $2^{31}-1$后又从0开始。首次建立连接的seq号是主机选择的该连接的初始序号ISN（Initial Sequence Number），之后第一个数据报文的第一个数据字节seq号是ISN+1。

* ***确认号***：确认号（ack）就是希望下一个收到的序号，也就是之前收到的seq号加1，但是只有ACK标志位置1时确认号才有效。

* ***首部长度***：首部长度的含义是首部32bit字的数目

* ***标志位***：

    * `SYN`：建立连接

    * `ACK`：确认号有效

    * `FIN`：发送端完成发送任务

    * `URG`：紧急指针有效

    * `PSH`：接收方尽快将此报文交给应用层

    * `RST`：重建连接

* ***窗口大小***：TCP流量控制由每一端的窗口大小提供。窗口大小单位是字节数，窗口最大值是65535

* ***校验和***：强制性字段，由发送端计算和存储。覆盖TCP首部与TCP数据

* ***紧急指针***：只有URG标志位置1时才有效

* ***可选字段***：最常见的可选字段是最长报文大小（Maximum Segment Size，MSS）



### 建立连接





### 断开连接