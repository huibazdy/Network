### 文件描述符（File Descriptor）

> **使用Linux提供的文件I/O函数，首先需要理解文件描述符**

文件描述符是操作系统分配给文件或者套接字的**整数**。

文件或套接字一般经过**创建过程后**才会被分配文件描述符。

文件描述符不过是方便称呼操作系统创建的文件或套接字而赋予的**代号**。

文件描述符有时也称为**文件句柄**（Windows中）。



### 文件I/O函数

#### 1.打开文件

要读些文件中的数据，首先要打开文件。为此定义了打开文件的函数，该函数有两个参数：1）目标文件名和路径；2）文件打开模式

```C
#include<sys/type.h>
#include<sys/stat.h>
#include<fcntl.h>

int open(const char *path,int flag); //成功返回文件描述符，失败返回-1
```

上述函数原型中的`path`是文件名的字符串地址，`flag`是文件打开模式信息。

关于打开模式的常量值极其含义见下表：

| 打开模式 | 含义                       |
| -------- | -------------------------- |
| O_CREAT  | 必要时创建文件             |
| O_TRUNC  | 删除全部现有数据           |
| O_APPEND | 维持现有数据，保存到其后面 |
| O_RDONLY | 只读打开                   |
| O_WRONLY | 只写打开                   |
| O_RDWR   | 读写打开                   |



#### 2.关闭文件

C语言学习过程中提到过，**使用文件后必须关闭**。

```C
#include<unistd.h>

int close(int fd);  //成功返回0，失败返回-1
```

此函数不仅**可以关闭文件也可以关闭套接字**，这也再次证明了对于Linux来说“万物皆文件”。



#### 3.写数据到文件

写数据主要使用`write()`函数。Linux中不区分文件和套接字，所以通过socket向其他计算机传输数据时也会用到此函数。

```C
#include<unistd.h>

ssize_t write(int fd,const void* buf,size_t nbytes);  //成功时返回写入字节数，否则-1
```

其中参数`fd`是要写入数据的文件描述符，`buf`是保存要传输的数据缓冲区地址，`nbytes`是需要传输的字节数。